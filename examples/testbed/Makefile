CONTIKI_PROJECT = app-rpl-ping-pong
CFLAGS += -DPROJECT_CONF_H=\"project-conf.h\"
TARGET ?= sky

APPS = deployment

CONFIG_NULLRDC=1
CONFIG_CONTIKIMAC=2
CONFIG_TSCH=3

DEPLOYMENT_COOJA=1
DEPLOYMENT_MOTES=2
DEPLOYMENT_TWIST=3
DEPLOYMENT_INDRIYA=4
DEPLOYMENT_NESTESTBED=5
DEPLOYMENT_IOTLAB=6

CONFG_STORING=1
CONFG_NON_STORING=2
RPL_CONFIG?=$(CONFG_NON_STORING)
#RPL_CONFIG?=$(CONFG_STORING)

CONFIG?=$(CONFIG_TSCH)
#CONFIG?=$(CONFIG_CONTIKIMAC)
#CONFIG?=$(CONFIG_NULLRDC)

ifeq ($(CONFIG),$(CONFIG_TSCH))
MODULES += core/net/mac/tsch
endif

PROBING ?= 1
SQUAREDETX ?= 0
FRESHONLY ?= 1
RSSI_BASED_ETX ?= 1
DAOACK ?= 0
CHANNELS ?= 4
RTX ?= 15
SMARTDUP ?= 1
FIXLOOP ?= 1

PANID ?= 0xABCD

CONTIKI_WITH_IPV6 = 1
CONTIKI_WITH_RPL = 1
CFLAGS+= -DCONFIG_NULLRDC=$(CONFIG_NULLRDC)
CFLAGS+= -DCONFIG_CONTIKIMAC=$(CONFIG_CONTIKIMAC)
CFLAGS+= -DCONFIG_TSCH=$(CONFIG_TSCH)
CFLAGS+= -DCONFIG_STORING=$(CONFG_STORING)
CFLAGS+= -DCONFIG_NON_STORING=$(CONFG_NON_STORING)
CFLAGS+= -DCONFIG=$(CONFIG)
CFLAGS+= -DRPL_CONFIG=$(RPL_CONFIG)
CFLAGS+= -DRPL_CONF_WITH_PROBING=$(PROBING)
CFLAGS+= -DRPL_CONF_SIWTCH_IFF_FRESH=$(FRESHONLY)
CFLAGS+= -DRPL_CONF_WITH_DAO_ACK=$(DAOACK)
CFLAGS+= -DRPL_MRHOF_CONF_SQUARED_ETX=$(SQUAREDETX)
CFLAGS+= -DRSSI_BASED_ETX=$(RSSI_BASED_ETX)
CFLAGS+= -DTSCH_CONF_NCHANNELS=$(CHANNELS)
CFLAGS+= -DTSCH_CONF_MAC_MAX_FRAME_RETRIES=$(RTX)
CFLAGS+= -DCONF_SMARTDUP=$(SMARTDUP)
CFLAGS+= -DRPL_CONF_FIXLOOP=$(FIXLOOP)
ifdef DEP
CFLAGS+= -DDEPLOYMENT=$(DEP)
endif
CFLAGS+= -DCMD_IEEE802154_PANID=$(PANID)

ifneq ($(CONFIG),$(CONFIG_CONTIKIMAC))
CFLAGS+= -DWITHOUT_CONTIKIMAC
endif
CFLAGS+= -DWITHOUT_COMPOWER
CFLAGS+= -DWITHOUT_6LOWPAN_ATTR
CFLAGS+= -DWITHOUT_MAC_TX_ATTR
CFLAGS+= -DWITHOUT_ATTR_TX_POWER
CFLAGS+= -DWITHOUT_ATTR_RELIABLE
CFLAGS+= -DWITHOUT_ATTR_LINK_QUALITY
CFLAGS+= -DWITHOUT_ATTR_TIMESTAMP
CFLAGS+= -DWITHOUT_ATTR_FRAME_TYPE

PROJECTDIRS += tools
PROJECT_SOURCEFILES += node-id.c

all: $(CONTIKI_PROJECT)

CONTIKI=../..
include $(CONTIKI)/Makefile.include

%.exe: %.sky
	cp $< $@
